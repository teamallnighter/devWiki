<h1>RTCPeerConnection.addTrack</h1> <p>The <a href="../rtcpeerconnection"><code>RTCPeerConnection</code></a> method <code>addTrack()</code> adds a new media track to the set of tracks which will be transmitted to the other peer.</p> <div class="note"> <p><strong>Note:</strong> Adding a track to a connection triggers renegotiation by firing an <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/negotiationneeded">negotiationneeded</a></code> event.</p> </div> <h2 id="Syntax">Syntax</h2> <pre class="syntaxbox"><em>rtpSender</em> = <em>RTCPeerConnection</em>.addTrack(<em>track</em>, <em>stream...</em>);</pre> <h3 id="Parameters">Parameters</h3> <dl> <dt><code>track</code></dt> <dd>A <a href="../mediastreamtrack"><code>MediaStreamTrack</code></a> object representing the media track to add to the peer connection.</dd> <dt><code>stream...</code></dt> <dd>One or more <a href="../mediastream"><code>MediaStream</code></a> objects in which the specified track are to be contained.</dd> </dl> <p>The specified <code>track</code> doesn't necessarily have to already be part of any of the specified <code>stream</code>s. Instead, the <code>stream</code>s are simply a way to group tracks together on the receiving end of the connection, making sure they are synchronized.</p> <h3 id="Return_value">Return value</h3> <p>The <a href="../rtcrtpsender"><code>RTCRtpSender</code></a> object which will be used to transmit the media data.</p> <div class="note"> <p><strong>Note:</strong> Every <code>RTCRtpSender</code> is paired with an <a href="../rtcrtpreceiver"><code>RTCRtpReceiver</code></a> to make up an <a href="../rtcrtptransceiver"><code>RTCRtpTransceiver</code></a>. The associated receiver is muted (indicating that it is not able to deliver packets) until and unless one or more streams are added to the receiver by the remote peer.</p> </div> <h4 id="Reused_senders">Reused senders</h4> <p>This method may return either a new <code>RTCRtpSender</code> or, under very specific circumstances, an existing compatible sender which has not yet been used to transmit data. Compatible reusable <code>RTCRtpSender</code> instances meet these criteria:</p> <ul> <li>There is no track already associated with the sender.</li> <li>The <a href="../rtcrtptransceiver"><code>RTCRtpTransceiver</code></a> associated with the sender has a <a href="../rtcrtpreceiver"><code>RTCRtpReceiver</code></a> whose <a href="../rtcrtpreceiver/track"><code>track</code></a> property specifies a <a href="../mediastreamtrack"><code>MediaStreamTrack</code></a> whose <a href="../mediastreamtrack/kind"><code>kind</code></a> is the same as the <code>kind</code> of the <code>track</code> parameter specified when calling <code>RTCPeerConnection.addTrack()</code>. This ensures that a transceiver only handles audio or video and never both.</li> <li>The <code>RTCRtpTransceiver</code>'s <a href="../rtcrtptransceiver/stopped"><code>stopped</code></a> property is <code>false</code>.</li> <li>The <code>RTCRtpSender</code> being considered has never been used to send data. If the transceiver's <a href="../rtcrtptransceiver/currentdirection"><code>currentDirection</code></a> has ever been <code>"sendrecv"</code> or <code>"sendonly"</code>, the sender can't be reused.</li> </ul> <p>If all of those criteria are met, the sender gets reused, which results in these changes occurring to the existing <code>RTCRtpSender</code> and its <code>RTCRtpTransceiver</code>:</p> <ul> <li>The <code>RTCRtpSender</code>'s <a href="../rtcrtpsender/track"><code>track</code></a> is set to the specified track.</li> <li>The sender's set of associated streams is set to the list of streams passed into this method, <code>stream...</code>.</li> <li>The associated <a href="../rtcrtptransceiver"><code>RTCRtpTransceiver</code></a> has its <code>currentDirection</code> updated to include sending; if its current value is <code>"recvonly"</code>, it becomes <code>"sendrecv"</code>, and if its current value is <code>"inactive"</code>, it becomes <code>"sendonly"</code>.</li> </ul> <h4 id="New_senders">New senders</h4> <p>If no existing sender exists that can be reused, a new one is created. This also results in the creation of the associated objects that must exist. The process of creating a new sender results in these changes:</p> <ul> <li>The new <code>RTCRtpSender</code> is created with the specified <code>track</code> and set of <code>stream</code>(s).</li> <li>A new <a href="../rtcrtpreceiver"><code>RTCRtpReceiver</code></a> is created with a <em>new</em> <a href="../mediastreamtrack"><code>MediaStreamTrack</code></a> as its <a href="../rtcrtpreceiver/track"><code>track</code></a> property (not the track specified as a parameter when calling <code>addTrack()</code>). This track's <a href="../mediastreamtrack/kind"><code>kind</code></a> is set to match the <code>kind</code> of the track provided as an input parameter.</li> <li>A new <a href="../rtcrtptransceiver"><code>RTCRtpTransceiver</code></a> is created and associated with the new sender and receiver.</li> <li>The new transceiver's <a href="../rtcrtptransceiver/direction"><code>direction</code></a> is set to <code>"sendrecv"</code>.</li> <li>The new transceiver is added to the <code>RTCPeerConnection</code>'s set of transceivers.</li> </ul> <h3 id="Exceptions">Exceptions</h3> <dl> <dt><code>InvalidAccessError</code></dt> <dd>The specified track (or all of its underlying streams) is already part of the <a href="../rtcpeerconnection"><code>RTCPeerConnection</code></a>.</dd> <dt><code>InvalidStateError</code></dt> <dd>The <a href="../rtcpeerconnection"><code>RTCPeerConnection</code></a> is closed.</dd> </dl> <h2 id="Example">Example</h2> <p>This example is drawn from the code presented in the article <a href="../webrtc_api/signaling_and_video_calling">Signaling and video calling</a> and its corresponding sample code. It comes from the <code>handleVideoOfferMsg()</code> method there, which is called when an offer message is received from the remote peer.</p> <pre data-language="js">var mediaConstraints = {
  audio: true,            // We want an audio track
  video: true             // ...and we want a video track
};

var desc = new RTCSessionDescription(sdp);

pc.setRemoteDescription(desc).then(function () {
  return navigator.mediaDevices.getUserMedia(mediaConstraints);
})
.then(function(stream) {
  previewElement.srcObject = stream;

  stream.getTracks().forEach(track =&gt; pc.addTrack(track, stream));
})</pre> <p>This code takes SDP which has been received from the remote peer and constructs a new <a href="../rtcsessiondescription"><code>RTCSessionDescription</code></a> to pass into <a href="setremotedescription"><code>setRemoteDescription()</code></a>. Once that succeeds, it uses <a href="../mediadevices/getusermedia"><code>MediaDevices.getUserMedia()</code></a> to obtain access to the local webcam and microphone.</p> <p>If that succeeds, the resulting stream is assigned as the source for a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video"><code>&lt;video&gt;</code></a> element which is referenced by the variable <code>previewElement</code>.</p> <p>The final step is to begin sending the local video across the peer connection to the caller. This is done by adding each track in the stream by iterating over the list returned by <a href="../mediastream/gettracks"><code>MediaStream.getTracks()</code></a> and passing them to <code>addTrack()</code> along with the <code>stream</code> which they're a component of.</p> <h2 id="Specifications">Specifications</h2> <div class="_table"><table class="standard-table"> <thead> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> </thead> <tbody> <tr> <td><a href="https://w3c.github.io/webrtc-pc/#dom-rtcpeerconnection-addtrack" hreflang="en">WebRTC 1.0: Real-time Communication Between Browsers<br><small>The definition of 'RTCPeerConnection.addTrack()' in that specification.</small></a></td> <td><span class="spec-CR">Candidate Recommendation</span></td> <td>Initial specification.</td> </tr> </tbody> </table></div> <h2 id="Browser_compatibility">Browser compatibility<a href="https://github.com/mdn/browser-compat-data" class="bc-github-link">Update compatibility data on GitHub</a>
</h2>  <div class="_table">
<table class="bc-table bc-table-web">
<thead>
<tr class="bc-platforms">
<th></th>
<th colspan="6">Desktop</th>
</tr>
<tr class="bc-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
</tr>
</thead>
<tbody><tr>
<th scope="row">Basic support 
</th>
<td class="bc-supports-yes"> 64</td>
<td class="bc-supports-yes"> Yes</td>
<td class="bc-supports-yes"> 22</td>
<td> ? </td>
<td class="bc-supports-yes"> 51</td>
<td> ? </td>
</tr></tbody>
</table>
<table class="bc-table bc-table-web">
<thead>
<tr class="bc-platforms">
<th></th>
<th colspan="7">Mobile</th>
</tr>
<tr class="bc-browsers">
<th></th>
<th>Android webview</th>
<th>Chrome for Android</th>
<th>Edge Mobile</th>
<th>Firefox for Android</th>
<th>Opera for Android</th>
<th>iOS Safari</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody><tr>
<th scope="row">Basic support 
</th>
<td class="bc-supports-yes"> 64</td>
<td class="bc-supports-yes"> 64</td>
<td class="bc-supports-yes"> Yes</td>
<td class="bc-supports-yes"> 44</td>
<td class="bc-supports-yes"> 51</td>
<td> ? </td>
<td class="bc-supports-yes"> 6.0</td>
</tr></tbody>
</table>
</div> <h2 id="See_also">See also</h2> <ul> <li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/WebRTC">WebRTC</a></li> <li><a href="../webrtc_api/intro_to_rtp">Introduction to the Real-time Transport Protocol (RTP)</a></li> <li><a href="ontrack"><code>RTCPeerConnection.ontrack</code></a></li> <li><code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/track">track</a></code></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addTrack$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2018 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addTrack" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addTrack</a>
  </p>
</div>
