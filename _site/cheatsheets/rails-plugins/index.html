<h2 id="generate-a-plugin">Generate a plugin</h2>

<p>Generate a Rails Engine plugin:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails plugin new myplugin --skip-bundle --full
</code></pre></div></div>

<h2 id="initializers">Initializers</h2>

<ul>
  <li><a href="http://edgeapi.rubyonrails.org/classes/Rails/Railtie.html">Rails::Railtie</a></li>
  <li><a href="http://www.engineyard.com/blog/2010/extending-rails-3-with-railties/">EngineYard blog 
post</a></li>
</ul>

<p>Subclass Railtie and provide an <code class="highlighter-rouge">initializer</code> method.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module NewPlugin
  class Railtie &lt; Rails::Railtie
    initializer "newplugin.initialize" do |app|
 
      # subscribe to all rails notifications: controllers, AR, etc.
      ActiveSupport::Notifications.subscribe do |*args|
        event = ActiveSupport::Notifications::Event.new(*args)
        puts "Got notification: #{event.inspect}"
      end
 
    end
  end
end
</code></pre></div></div>

<h2 id="custom-routes">Custom routes</h2>

<ul>
  <li><a href="http://api.rubyonrails.org/classes/ActionDispatch/Routing/Mapper.html">ActionDispatch::Routing::Mapper</a></li>
</ul>

<p>To create custom <code class="highlighter-rouge">routes.rb</code> keywords:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># # routes.rb:
# myplugin_for x
#
class ActionDispatch::Routing
  class Mapper
    def myplugin_for(*x)
    end
  end
end
</code></pre></div></div>

<p>Example with a block:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># authenticated do
#   resources :users
# end
#
def authenticated
  constraint = lambda { |request| request... }

  constraints(constraint) { yield }
end
</code></pre></div></div>

<h2 id="custom-generators">Custom generators</h2>

<ul>
  <li><a href="http://guides.rubyonrails.org/generators.html">Guide: generators</a></li>
  <li><a href="http://api.rubyonrails.org/classes/ActiveRecord/Generators/Base.html">ActiveRecord::Generators::Base</a></li>
</ul>

<h3 id="basic">Basic</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rails g initializer
# lib/generators/initializer_generator.rb
class InitializerGenerator &lt; Rails::Generators::Base
  def create_initializer_file
    create_file "config/initializers/initializer.rb", "# Add initialization content here"
  end
end
</code></pre></div></div>

<ul>
  <li>Extend <code class="highlighter-rouge">Rails::Generators::Base</code>.</li>
  <li>Each public method in the generator is executed when a generator is invoked.</li>
</ul>

<h3 id="generating-a-generator">Generating a generator</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rails generate generator initializer
</code></pre></div></div>

<h3 id="namedbase">NamedBase</h3>

<p>Use <code class="highlighter-rouge">NamedBase</code> instead if you want to take an argument. It will be available as 
<code class="highlighter-rouge">file_name</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class InitializerGenerator &lt; Rails::Generators::Base
  def lol
    puts file_name
  end
end
</code></pre></div></div>

<h3 id="more">More</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class InitializerGenerator &lt; Rails::Generators::NamedBase
  # 
  source_root File.expand_path("../templates", __FILE__)
  desc "Description goes here."
end
</code></pre></div></div>

<h3 id="generators-lookup">Generators lookup</h3>

<p>When invoking <code class="highlighter-rouge">rails g XXX</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[rails/]generators/XXX/XXX_generator.rb
[rails/]generators/XXX_generator.rb
</code></pre></div></div>

<p>When invoking <code class="highlighter-rouge">rails g XXX:YYY</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[rails/]generators/XXX/YYY_generator.rb
</code></pre></div></div>

<h2 id="activemodel-acts-as">ActiveModel ‘acts as’</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># yaffle/lib/yaffle/acts_as_yaffle.rb
module Yaffle
  module ActsAsYaffle
    extend ActiveSupport::Concern
 
    included do
    end
 
    module ClassMethods
      def acts_as_yaffle(options = {})
        # your code will go here
      end
    end
  end
end
 
ActiveRecord::Base.send :include, Yaffle::ActsAsYaffle
</code></pre></div></div>

