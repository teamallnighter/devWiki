<h1>ExtendableEvent</h1><div class="notice overheadIndicator experimental"> <p> <strong>This is an <a href="https://developer.mozilla.org/en-US/docs/MDN/Contribute/Guidelines/Conventions_definitions#Experimental">experimental technology</a></strong><br>Check the <a href="#Browser_compatibility">Browser compatibility table</a> carefully before using this in production.</p> </div> <p>The <code>ExtendableEvent</code> interface extends the lifetime of the <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/install">install</a></code> and <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/activate">activate</a></code> events dispatched on the global scope as part of the service worker lifecycle. This ensures that any functional events (like <a href="fetchevent"><code>FetchEvent</code></a>) are not dispatched until it upgrades database schemas and deletes the outdated cache entries.</p> <p>If <a href="extendableevent/waituntil"><code>waitUntil()</code></a> is called outside of the <code>ExtendableEvent</code> handler, the browser should throw an <code>InvalidStateError</code>; note also that multiple calls will stack up, and the resulting promises will be added to the list of <a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#dfn-extend-lifetime-promises">extend lifetime promises</a>.</p> <div class="note"> <p><strong>Note</strong>: The behaviour described in the above paragraph was fixed in Firefox 43 (see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1189644">bug 1189644</a>.)</p> </div> <p>This interface inherits from the <a href="event"><code>Event</code></a> interface.</p>  <iframe src="https://mdn.mozillademos.org/en-US/docs/Web/API/ExtendableEvent%24samples/inheritance_diagram?revision=1409824" height="60" class="live-sample-frame inheritance-diagram-frame" width="700" frameborder="0" id="frame_inheritance_diagram"></iframe> <div class="note"> <p><strong>Note</strong>: This interface is only available when the global scope is a <a href="serviceworkerglobalscope"><code>ServiceWorkerGlobalScope</code></a>. It is not available when it is a <a href="window"><code>Window</code></a>, or the scope of another kind of worker.</p> </div> <h2 id="Constructor">Constructor</h2> <dl> <dt><a href="extendableevent/extendableevent"><code>ExtendableEvent()</code></a></dt> <dd>Creates a new <code>ExtendableEvent</code> object.</dd> </dl> <h2 id="Properties">Properties</h2> <p><em>Doesn't implement any specific properties, but inherits properties from its parent, <a href="event"><code>Event</code></a>.</em></p> <h2 id="Methods">Methods</h2> <p><em>Inherits methods from its parent, </em><em><a href="event"><code>Event</code></a></em>.</p> <dl> <dt><a href="extendableevent/waituntil"><code>ExtendableEvent.waitUntil()</code></a></dt> <dd> <p>Extends the lifetime of the event. It is intended to be called in the <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/install">install</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventHandler"><code>EventHandler</code></a> for the <a href="serviceworkerregistration/installing"><code>installing</code></a> worker and on the <code><a href="https://developer.mozilla.org/en-US/docs/Web/Events/active">active</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventHandler"><code>EventHandler</code></a> for the <a href="serviceworkerregistration/active"><code>active</code></a> worker.</p> </dd> </dl> <h2 id="Examples">Examples</h2> <p>This code snippet is from the <a href="https://github.com/GoogleChrome/samples/blob/gh-pages/service-worker/prefetch/service-worker.js">service worker prefetch sample</a> (see <a href="https://googlechrome.github.io/samples/service-worker/prefetch/">prefetch example live</a>.) The code calls <a href="extendableevent/waituntil"><code>ExtendableEvent.waitUntil()</code></a> in <a href="serviceworkerglobalscope/oninstall"><code>ServiceWorkerGlobalScope.oninstall</code></a>, delaying treating the <a href="serviceworkerregistration/installing"><code>ServiceWorkerRegistration.installing</code></a> worker as installed until the passed promise resolves successfully. The promise resolves when all resources have been fetched and cached, or else when any exception occurs.</p> <p>The code snippet also shows a best practice for versioning caches used by the service worker. Though there's only one cache in this example, the same approach can be used for multiple caches. It maps a shorthand identifier for a cache to a specific, versioned cache name.</p> <div class="note"> <p><strong>Note</strong>: In Chrome, logging statements are visible via the "Inspect" interface for the relevant service worker accessed via chrome://serviceworker-internals.</p> </div> <pre data-language="js">var CACHE_VERSION = 1;
var CURRENT_CACHES = {
  prefetch: 'prefetch-cache-v' + CACHE_VERSION
};

self.addEventListener('install', function(event) {
  var urlsToPrefetch = [
    './static/pre_fetched.txt',
    './static/pre_fetched.html',
    'https://www.chromium.org/_/rsrc/1302286216006/config/customLogo.gif'
  ];

  console.log('Handling install event. Resources to pre-fetch:', urlsToPrefetch);

  event.waitUntil(
    caches.open(CURRENT_CACHES['prefetch']).then(function(cache) {
      cache.addAll(urlsToPrefetch.map(function(urlToPrefetch) {
        return new Request(urlToPrefetch, {mode: 'no-cors'});
      })).then(function() {
        console.log('All resources have been fetched and cached.');
      });
    }).catch(function(error) {
      console.error('Pre-fetching failed:', error);
    })
  );
});</pre> <div class="note">
<strong>Important</strong>: When fetching resources, it's very important to use <code>{mode: 'no-cors'}</code> if there is any chance that the resources are served off of a server that doesn't support <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>. In this example, <a href="http://www.chromium.org">www.chromium.org</a> doesn't support CORS.</div> <h2 id="Specifications">Specifications</h2> <div class="_table"><table class="standard-table"> <tbody> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> <tr> <td><a href="https://w3c.github.io/ServiceWorker/#extendable-event" hreflang="en">Service Workers<br><small>The definition of 'ExtendableEvent' in that specification.</small></a></td> <td><span class="spec-WD">Working Draft</span></td> <td>Initial definition.</td> </tr> </tbody> </table></div> <h2 id="Browser_compatibility">Browser compatibility<a href="https://github.com/mdn/browser-compat-data" class="bc-github-link">Update compatibility data on GitHub</a>
</h2>   <div class="_table">
<table class="bc-table bc-table-web">
<thead>
<tr class="bc-platforms">
<th></th>
<th colspan="6">Desktop</th>
</tr>
<tr class="bc-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
</tr>
</thead>
<tbody>
<tr>
<th scope="row">Basic support 
</th>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-yes"> 17</td>
<td class="bc-supports-yes bc-has-history"> 44
<dl>
<dt class="bc-supports-yes bc-supports"> 44
</dt>
<dd> Service workers (and Push) have been disabled in the Firefox 45 &amp; 52 Extended Support Releases (ESR).</dd>
</dl>
</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 24</td>
<td class="bc-supports-no"> No</td>
</tr>
<tr>
<th scope="row">
<a href="https://developer.mozilla.org/docs/Web/API/ExtendableEvent/ExtendableEvent"><code>ExtendableEvent()</code> constructor</a> 
</th>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-yes"> 17</td>
<td class="bc-supports-yes bc-has-history"> 44
<dl>
<dt class="bc-supports-yes bc-supports"> 44
</dt>
<dd> Service workers (and Push) have been disabled in the Firefox 45 &amp; 52 Extended Support Releases (ESR).</dd>
</dl>
</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 24</td>
<td class="bc-supports-no"> No</td>
</tr>
<tr>
<th scope="row">
<a href="https://developer.mozilla.org/docs/Web/API/ExtendableEvent/waitUntil"><code>waitUntil</code></a> 
</th>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-yes"> 17</td>
<td class="bc-supports-yes"> 44</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 24</td>
<td class="bc-supports-no"> No</td>
</tr>
</tbody>
</table>
<table class="bc-table bc-table-web">
<thead>
<tr class="bc-platforms">
<th></th>
<th colspan="7">Mobile</th>
</tr>
<tr class="bc-browsers">
<th></th>
<th>Android webview</th>
<th>Chrome for Android</th>
<th>Edge Mobile</th>
<th>Firefox for Android</th>
<th>Opera for Android</th>
<th>iOS Safari</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody>
<tr>
<th scope="row">Basic support 
</th>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 44</td>
<td class="bc-supports-yes"> 24</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 4.0</td>
</tr>
<tr>
<th scope="row">
<a href="https://developer.mozilla.org/docs/Web/API/ExtendableEvent/ExtendableEvent"><code>ExtendableEvent()</code> constructor</a> 
</th>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 44</td>
<td class="bc-supports-yes"> 24</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 4.0</td>
</tr>
<tr>
<th scope="row">
<a href="https://developer.mozilla.org/docs/Web/API/ExtendableEvent/waitUntil"><code>waitUntil</code></a> 
</th>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-yes"> 40</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 44</td>
<td class="bc-supports-yes"> 24</td>
<td class="bc-supports-no"> No</td>
<td class="bc-supports-yes"> 4.0</td>
</tr>
</tbody>
</table>
</div>  <h2 id="See_also">See also</h2> <ul> <li><a href="service_worker_api/using_service_workers">Using Service Workers</a></li> <li><a href="https://github.com/mdn/sw-test">Service workers basic code example</a></li> <li><a href="https://jakearchibald.github.io/isserviceworkerready/">Is ServiceWorker ready?</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Performance/Using_web_workers">Using web workers</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent$edit" class="_attribution-link">Edit this page on MDN</a>
  </p>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2018 Mozilla Developer Network and individual contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent</a>
  </p>
</div>
